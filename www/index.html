<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: content: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <title>Monaca Education ダイレクトプレビュー</title>
    <script src="components/loader.js"></script>
    <link rel="stylesheet" href="components/loader.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/education.js" defer></script>
    <script src="js/config.js" defer></script>
    <script src="js/main.js" defer></script>
    <script>
        //コインの増加
        var coins = 0;
        var jsonkane;
        var jsoncoins;
        var kane = document.getElementById('kane');

            window.setInterval(icr, 1000);

        function icr() {
            coins++;
            kane = document.getElementById('kane');
            kane.innerHTML = coins;
            jsonkane = JSON.stringify(kane);
            localStorage.setItem("skane", jsonkane);
            jsoncoins = JSON.stringify(coins);
            localStorage.setItem("scoins", jsoncoins);
        }
    </script>
</head>

<body style="width:100%;padding:0;margin:0;">
    <img src="img/eye2.png" id="me" onclick="remove()" class="remove" style="width: 10%;height: 7%;z-index: calc(infinity);">
    <button id="createbutton" onclick="menu()" class="remove" style="height:8%;width:40%;top:70%;z-index: calc(infinity);">
    <a class = "remove">CREATE</a>
    </button>
    <nav class="navi remove">
        <ul class="objectlist">
            <li><img src="img/tree1.png" class="object"></li>
            <li><img src="img/tree2.png" class="object"></li>
            <li><img src="img/tree3.png" class="object"></li>
            <li><img src="img/tree4.png" class="object"></li>
            <li><img src="img/tree5.png" class="object"></li>
            <li><img src="img/tree6.png" class="object"></li>
            <li><img src="img/ftree1.png" class="object"></li>
            <li><img src="img/ftree2.png" class="object"></li>
            <li><img src="img/ftree3.png" class="object"></li>
            <li><img src="img/ftree4.png" class="object"></li>
            <li><img src="img/ftree5.png" class="object"></li>
            <li><img src="img/bush1.png" class="object"></li>
        </ul>
    </nav>
    <div style="position:absolute;widht:100%;height:100%;top:80%;left:30%;">
        <div class = "remove"><span id="kane">0</span>coins</div>
    </div>
    <img src="img/ka-soru.png" id="ka-soru" class="remove" style="top:80%;width:9%;height:4%;z-index: calc(infinity);">
    <div style="position:absolute;bottom:0;display:flex;width:100%;border:solid 1px 0px 0px 0px;border-bottom:0;height:15%;" class="remove">
        <button class="under-btn" style="z-index: calc(infinity);"><img src="img/enpitu.png" id="under-image" class="remove"></button>
        <button class="under-btn" style="border-left:none;border-right:none;z-index: calc(infinity);"><img src="img/omise.png" id="under-image" class="remove"onclick = "location.href='./store.html'"></button>
        </dvi>
        <audio id="bgm">
        <source src = "audio/BGM.mp3" loop>
    </audio>
        <script>
            var num = 0;
            //BGMの再生
            function audio() {
                //完成後消すvar audio = document.getElementById('bgm').play();
            }
            audio();

            //メニューバーの表示
            function menu() {
                var navi = document.getElementsByClassName('navi');
                navi[0].classList.toggle('open');
            }

            //UIの非表示化
            function remove() {
                var remove = document.getElementsByClassName('remove');
                remove[1].classList.toggle('invisible');
                remove[2].classList.toggle('invisible');
                remove[3].classList.toggle('invisible');
                remove[4].classList.toggle('invisible');
                remove[5].classList.toggle('invisible');
                remove[6].classList.toggle('invisible');
                remove[7].classList.toggle('invisible');
                remove[8].classList.toggle('invisible');
                if (num == 1) {
                    num = 0;
                    document.getElementById("me").src = "img/eye2.png";
                } else {
                    num++;
                    document.getElementById("me").src = "img/eye1.png";
                }
            }
            //画像の移動
            const objectlist = document.querySelector(".objectlist");
            const object = document.querySelectorAll(".object");

            window.addEventListener("mousedown", RemoveImg);

            let start_x = 0;
            let start_y = 0;
            let onc = false;
            let copyImg = null;

            //元画像を消す
            function RemoveImg(e) {
                if (e.target.className == "object") {
                    onc = true;
                    var navi = document.getElementsByClassName('navi');
                    navi[0].classList.toggle('open');
                    let clickImg = e.target;
                    clickImg.style.opacity = "0";
                    clickImg.style.pointerEvents = "none";
                    copyImg = CopyImg(clickImg);
                    document.body.appendChild(copyImg);
                    copyImg.style.position = "absolute";
                    copyImg.style.pointerEvents = "none";
                    start_x = Number(e.pageX) - (clickImg.getBoundingClientRect().left);
                    start_y = Number(e.pageY) - (clickImg.getBoundingClientRect().top);
                    console.log(start_x + " : " + start_y);

                    copyImg.style.left = e.pageX - start_x;
                    copyImg.style.top = e.pageY - start_y;
                }
            }

            //カーソルに画像を追尾させる
            document.addEventListener("mousemove", (e) => {
                if (onc) {
                    copyImg.style.left = (Number(e.pageX) - start_x) + "px";
                    copyImg.style.top = (Number(e.pageY) - start_y) + "px";
                }
            });

            //離したら終了
            document.addEventListener("mouseup", () => {
                onc = false;
            });

            function Homing(element) {

            }

            //画像を再挿入
            function CopyImg(motoImg) {
                let copyImg = document.createElement("img");
                copyImg.src = motoImg.getAttribute("src");
                copyImg.width = motoImg.width;
                copyImg.height = motoImg.height;
                copyImg.style.position = "absolute";
                return copyImg;
            }

            //再代入
            var savecoins = localStorage.getItem("scoins");
            coins = JSON.parse(savecoins);
            var savekane = localStorage.getItem("skane");
            kane = JSON.parse(savekane);
            if (coins !== 0) {
                kane = document.getElementById('kane');
                kane.innerHTML = coins;
            }
        </script>
</body>

</html>